<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MuslimVerse тАУ Sign Up</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
      #kalima-section {
          transition: all 0.5s ease-in-out;
          max-height: 0;
          overflow: hidden;
      }
      #kalima-section.visible {
          max-height: 500px; /* ржкрзНрж░рзЯрзЛржЬржи ржЕржирзБржпрж╛рзЯрзА ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рж╛ ржпрж╛ржмрзЗ */
          padding-top: 1rem;
          padding-bottom: 1rem;
      }
  </style>
</head>
<body class="bg-green-50 flex items-center justify-center min-h-screen px-4 py-8">

  <div class="bg-white shadow-lg rounded-lg p-6 w-full max-w-md">
    <h1 class="text-3xl font-extrabold text-center text-green-700 mb-4">ЁЯХЛ MuslimVerse</h1>
    <h2 class="text-lg font-semibold mb-4 text-center">тЬНя╕П Create Your Account</h2>

    <form onsubmit="signUp(); return false;">
      <input id="fullName" type="text" placeholder="Full Name" required class="w-full p-3 border border-gray-300 rounded mb-3 focus:outline-none focus:ring-2 focus:ring-green-300" />
      <input id="username" type="text" placeholder="Username (e.g., ahmed123, no spaces)" required class="w-full p-3 border border-gray-300 rounded mb-3 focus:outline-none focus:ring-2 focus:ring-green-300" />
      <input id="email" type="email" placeholder="Email" required class="w-full p-3 border border-gray-300 rounded mb-3 focus:outline-none focus:ring-2 focus:ring-green-300" />
      <input id="password" type="password" placeholder="Password (at least 6 characters)" required class="w-full p-3 border border-gray-300 rounded mb-3 focus:outline-none focus:ring-2 focus:ring-green-300" />
      
      <select id="religion" onchange="handleReligionChange()" required class="w-full p-3 border border-gray-300 rounded mb-2 bg-white focus:outline-none focus:ring-2 focus:ring-green-300">
        <option value="" selected disabled>-- Select your religion --</option>
        <option value="islam">Islam</option>
        <!-- ржнржмрж┐рж╖рзНржпрждрзЗ ржЕржирзНржпрж╛ржирзНржп ржЕржкрж╢ржи ржпрзЛржЧ ржХрж░рж╛ ржпрзЗрждрзЗ ржкрж╛рж░рзЗ -->
      </select>
      
      <!-- ржХрж╛рж▓рж┐ржорж╛ рж╢рж╛рж╣рж╛ржжрж╛ржд рж╕рзЗржХрж╢ржи (ржбрж┐ржлрж▓рзНржЯржнрж╛ржмрзЗ рж▓рзБржХрж╛ржирзЛ) -->
      <div id="kalima-section">
          <div class="bg-green-50 p-4 rounded-lg border border-green-200 text-center">
              <p class="text-xl font-semibold text-green-800">╪г┘О╪┤┘Т┘З┘О╪п┘П ╪г┘О┘Ж┘Т ┘Д┘О╪з ╪е┘Р┘Д┘О┘░┘З┘О ╪е┘Р┘Д┘О┘С╪з ┘▒┘Д┘Д┘О┘С┘░┘З┘П ┘И┘О╪г┘О╪┤┘Т┘З┘О╪п┘П ╪г┘О┘Ж┘О┘С ┘Е┘П╪н┘О┘Е┘О┘С╪п┘Л╪з ╪▒┘О╪│┘П┘И┘Д┘П ┘▒┘Д┘Д┘О┘С┘░┘З┘Р</p>
              <p class="text-sm text-gray-700 mt-2"><i>Ash-hadu an la ilaha illallah, wa ash-hadu anna Muhammadan Rasoolullah.</i></p>
              <p class="text-sm text-gray-600 mt-2">"ржЖржорж┐ рж╕рж╛ржХрзНрж╖рзНржп ржжрж┐ржЪрзНржЫрж┐ ржпрзЗ, ржЖрж▓рзНрж▓рж╛рж╣ ржЫрж╛рзЬрж╛ ржХрзЛржирзЛ ржЙржкрж╛рж╕рзНржп ржирзЗржЗ ржПржмржВ ржЖржорж┐ ржЖрж░ржУ рж╕рж╛ржХрзНрж╖рзНржп ржжрж┐ржЪрзНржЫрж┐ ржпрзЗ, ржорзБрж╣рж╛ржорзНржоржж (рж╕рж╛ржГ) ржЖрж▓рзНрж▓рж╛рж╣рж░ рж░рж╛рж╕рзВрж▓ред"</p>
          </div>
          <div class="mt-4 flex items-center">
              <input type="checkbox" id="agree-kalima" onchange="toggleSignUpButton()" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500">
              <label for="agree-kalima" class="ml-2 block text-sm text-gray-900">ржЖржорж┐ ржХрж╛рж▓рж┐ржорж╛ рж╢рж╛рж╣рж╛ржжрж╛рждрзЗрж░ ржЙржкрж░ ржмрж┐рж╢рзНржмрж╛рж╕ рж╕рзНржерж╛ржкржи ржХрж░ржЫрж┐ ржПржмржВ рж╕рж╛ржХрзНрж╖рзНржп ржжрж┐ржЪрзНржЫрж┐ред</label>
          </div>
      </div>
      
      <button id="signup-button" type="submit" disabled class="w-full bg-green-600 text-white p-3 rounded font-semibold hover:bg-green-700 transition duration-200 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center">
        <span id="signup-btn-text">Sign Up</span>
        <span id="signup-spinner" class="hidden w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin ml-2"></span>
      </button>

      <a href="login.html" class="block text-center text-green-700 mt-4 hover:underline font-medium">
        Already have an account? Login
      </a>
    </form>

    <p id="signupStatus" class="text-sm mt-4 text-center"></p>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD3VEv_rdd3FElJupOnfGrBQuLjGwACsA8",
      authDomain: "masklink-calling.firebaseapp.com",
      databaseURL: "https://masklink-calling-default-rtdb.firebaseio.com",
      projectId: "masklink-calling",
      storageBucket: "masklink-calling.appspot.com",
      messagingSenderId: "240213769733",
      appId: "1:240213769733:web:53e35fbf17e4b4d284266c"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    function handleReligionChange() {
        const religion = document.getElementById("religion").value;
        const kalimaSection = document.getElementById("kalima-section");
        
        if (religion === "islam") {
            kalimaSection.classList.add("visible");
        } else {
            kalimaSection.classList.remove("visible");
        }
        toggleSignUpButton(); // ржкрзНрж░рждрж┐ржмрж╛рж░ ржзрж░рзНржо ржкрж░рж┐ржмрж░рзНрждржи рж╣рж▓рзЗ ржмрж╛ржЯржи ржЪрзЗржХ ржХрж░ржмрзЗ
    }

    function toggleSignUpButton() {
        const religion = document.getElementById("religion").value;
        const agreeCheckbox = document.getElementById("agree-kalima");
        const signUpButton = document.getElementById("signup-button");
        
        // ржпржжрж┐ ржзрж░рзНржо ржЗрж╕рж▓рж╛ржо рж╣рзЯ ржПржмржВ ржХрж╛рж▓рж┐ржорж╛ ржЪрзЗржХ ржХрж░рж╛ ржерж╛ржХрзЗ, рждржмрзЗржЗ ржмрж╛ржЯржи ржПржирж╛ржмрж▓ рж╣ржмрзЗ
        if (religion === "islam" && agreeCheckbox.checked) {
            signUpButton.disabled = false;
        } else {
            signUpButton.disabled = true;
        }
    }

    function signUp() {
      const fullName = document.getElementById("fullName").value.trim();
      const username = document.getElementById("username").value.trim().toLowerCase();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;
      const religion = document.getElementById("religion").value;
      const agreeKalima = document.getElementById("agree-kalima").checked;
      const signupStatus = document.getElementById("signupStatus");

      const signupBtn = document.getElementById("signup-button");
      const signupBtnText = document.getElementById("signup-btn-text");
      const signupSpinner = document.getElementById("signup-spinner");

      // Validation
      if (religion !== "islam" || !agreeKalima) {
          signupStatus.style.color = 'red';
          signupStatus.textContent = "тЭМ ржХрж╛рж▓рж┐ржорж╛ рж╢рж╛рж╣рж╛ржжрж╛ржд рж╕рзНржмрзАржХрж╛рж░ ржХрж░рж╛ ржЖржмрж╢рзНржпржХред";
          return;
      }
      if (!/^[a-z0-9_]+$/.test(username) || username.length < 3) {
          signupStatus.style.color = 'red';
          signupStatus.textContent = "тЭМ ржЗржЙржЬрж╛рж░ржирзЗржо ржХржоржкржХрзНрж╖рзЗ рзй ржЕржХрзНрж╖рж░рзЗрж░ рж╣рждрзЗ рж╣ржмрзЗ ржПржмржВ ржХрзЛржирзЛ рж╕рзНржкрзЗрж╕ ржерж╛ржХржмрзЗ ржирж╛ред";
          return;
      }
      
      // Set loading state
      signupBtn.disabled = true;
      signupBtnText.textContent = "Creating Account...";
      signupSpinner.classList.remove("hidden");
      signupStatus.textContent = "";

      // Firebase Logic
      db.ref('usernames/' + username).once('value').then(snapshot => {
          if (snapshot.exists()) {
              throw new Error("This username is already taken.");
          }
          return auth.createUserWithEmailAndPassword(email, password);
      })
      .then((userCredential) => {
          const user = userCredential.user;
          const defaultEmoji = ['ЁЯСд', 'ЁЯШК', 'ЁЯМЯ', 'ЁЯТб', 'ЁЯХМ', 'ЁЯХЛ'][Math.floor(Math.random() * 6)];
          
          const profileData = {
              uid: user.uid,
              fullName: fullName,
              username: username,
              email: email,
              profileEmoji: defaultEmoji,
              religion: religion
          };

          const updates = {};
          updates['/userProfiles/' + user.uid] = profileData;
          updates['/usernames/' + username] = { uid: user.uid };
          return db.ref().update(updates);
      })
      .then(() => {
          signupStatus.style.color = 'green';
          signupStatus.textContent = "тЬЕ ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯ рж╕ржлрж▓ржнрж╛ржмрзЗ рждрзИрж░рж┐ рж╣рзЯрзЗржЫрзЗ! ржЖржкржирж╛ржХрзЗ рж▓ржЧржЗржи ржкрзЗржЬрзЗ ржирж┐ржпрж╝рзЗ ржпрж╛ржУржпрж╝рж╛ рж╣ржЪрзНржЫрзЗ...";
          
          // Redirect to login page
          setTimeout(() => {
              window.location.href = "login.html";
          }, 2000);
      })
      .catch((error) => {
          signupStatus.style.color = 'red';
          signupStatus.textContent = "тЭМ " + error.message;

          // Reset button state
          signupBtn.disabled = false;
          signupBtnText.textContent = "Sign Up";
          signupSpinner.classList.add("hidden");
          toggleSignUpButton(); // Re-check if button should be enabled
      });
    }
  </script>
</body>
</html>
